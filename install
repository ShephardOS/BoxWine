#!/bin/bash

echo "Select Language / Выберите язык:"
echo "1) English"
echo "2) Русский"
read -p "Enter number / Введите номер: " lang

case "$lang" in
1)
    msg_installing="Installing packages..."
    msg_download_fail="Download failed"
    msg_done="Installation complete. Use 'boxwine' to start."
    ;;
2)
    msg_installing="Установка пакетов..."
    msg_download_fail="Ошибка загрузки"
    msg_done="Установка завершена. Используйте 'boxwine' для запуска."
    ;;
*)
    echo "Invalid selection / Неверный выбор"
    exit 1
    ;;
esac

echo "$msg_installing"

apt-get clean
apt-get update >/dev/null 2>&1
apt-get -y --with-new-pkgs -o Dpkg::Options::="--force-confdef" upgrade >/dev/null 2>&1
pkg install x11-repo -y &>/dev/null
pkg install pulseaudio -y &>/dev/null
pkg install xwayland -y &>/dev/null
pkg install wget -y &>/dev/null
pkg install tsu -y &>/dev/null
pkg install root-repo -y &>/dev/null
pkg install patchelf -y &>/dev/null
pkg install p7zip -y &>/dev/null
pkg install xorg-xrandr -y &>/dev/null
pkg install ncurses-utils -y &>/dev/null
pkg install hashdeep -y &>/dev/null
pkg install termux-x11-nightly -y &>/dev/null
pkg install xfce4 -y &>/dev/null

function wget-git-q {
    wget -q --retry-connrefused --tries=0 --header "PRIVATE-TOKEN: glpat-6LE7R9PQ7zb6zsx4x3be" \
    "https://gitlab.com/api/v4/projects/67947913/repository/files/$1/raw?ref=main" -O $2
    return $?
}

mkdir -p $PREFIX/glibc/opt/package-manager/installed

echo "PRIVATE_TOKEN=glpat-6LE7R9PQ7zb6zsx4x3be
PROJECT_ID=67947913" > $PREFIX/glibc/opt/package-manager/token

echo 'termux-x11 :1 & sleep 2; export DISPLAY=:1; xfce4-session' > $PREFIX/bin/boxwine

echo "$msg_done"
